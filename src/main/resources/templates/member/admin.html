<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Member List</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

</head>

<body>
<div class="container">
    <!-- 검색창 추가 -->
    <form class="row g-3" th:action="@{/admin}" method="get">
        <div class="col-auto">
            <input type="text" class="form-control" name="keyword" placeholder="ID를 입력해 주세요">
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary mb-3">검색</button>
        </div>
    </form>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th><input type='checkbox' id="all_checkbox"></th>
            <th>ID</th>
            <th>닉네임</th>
            <th>최근 로그인 일자</th>
            <th>상태</th>
        </tr>
        </thead>
        <tbody id="memberTableBody">
        <!-- memberList를 통해 내용이 들어갈 부분 -->
        </tbody>
    </table>
    <button id="delete_btn" onclick="remove()">선택 회원 삭제</button>
</div>

<!-- Bootstrap 5 JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.2/js/bootstrap.min.js"></script>

<!-- Ajax를 이용해 memberList 데이터를 가져와서 렌더링하는 스크립트 -->
<script type="text/javascript">
    $(window).on('load', function(){
        // url에서 keyword를 가져오기 위한 코드
        var urlParams = new URLSearchParams(window.location.search);
        var keyword = urlParams.get('keyword');
        console.log(keyword);
        // Ajax를 이용해 memberList 데이터를 가져온 후 렌더링하는 코드
        $.ajax({
            url: "/admin_memberList",
            data: {keyword: keyword},
            success: function(data){


                // 가져온 member 데이터를 통해 tbody 내부에 새로운 tr을 추가하는 코드
                $.each(data, function(index, member){
                    var status = "";
                    if(member.memStatus == 0) {
                        status = "<select ><option value='0' selected>탈퇴회원</option><option value='1'>일반회원</option><option value='2'>휴먼회원</option><option value='9'>관리자</option></select>";
                    } else if(member.memStatus == 1) {
                        status = "<select ><option value='0'>탈퇴회원</option><option value='1' selected>일반회원</option><option value='2'>휴먼회원</option><option value='9'>관리자</option></select>";
                    } else if(member.memStatus == 2) {
                        status = "<select ><option value='0'>탈퇴회원</option><option value='1'>일반회원</option><option value='2' selected>휴먼회원</option><option value='9'>관리자</option></select>";
                    } else if(member.memStatus == 9) {
                        status = "<select ><option value='0'>탈퇴회원</option><option value='1'>일반회원</option><option value='2'>휴먼회원</option><option value='9' selected>관리자</option></select>";
                    }

                    var checkboxValue = member.memId;
                    var row = "<tr>" +
                        "<td><input type='checkbox' value='" + checkboxValue + "'></td>" +
                        "<td>" + member.memId + "</td>" +
                        "<td>" + member.memName + "</td>" +
                        "<td>" + member.memLogin + "</td>" +
                        "<td>" + status + "</td>" +
                        "</tr>";
                    $("#memberTableBody").append(row);
                });
            }

        });
    });
    // "all_checkbox" 체크박스 클릭 이벤트 처리
    $('#all_checkbox').click(function() {
        // 만약 "all_checkbox" 체크박스가 체크되어 있다면
        if($(this).is(':checked')) {
            // 모든 체크박스를 선택
            $('input[type="checkbox"]').prop('checked', true);
        } else {
            // 그렇지 않다면 모든 체크박스를 선택 해제
            $('input[type="checkbox"]').prop('checked', false);
        }
    });


    //호스트정보 삭제
    function remove() {
        var count = $("input[type='checkbox']:checked").length;
        var removeArray = new Array();
        $("input[type='checkbox']:checked").each(function() {
            removeArray.push($(this).val());
        });
        if (count == 0) {
            alert("선택된 회원이 없습니다.");
        } else {
            if (confirm("회원 정보를 삭제 하시겠습니까?")) {
                $.ajax({
                    type: "POST",
                    url: "/admin_delete",
                    data: { memIdList: JSON.stringify(removeArray) },
                    dataType: "text",
                    success: function(result) {
                        if (result == "success") {
                            // 삭제 성공 시 처리할 코드 작성
                        }
                    },
                    error: function(xhr) {
                        alert("에러코드(회원 정보 삭제) = " + xhr.status);
                    }
                });
            }
        }
    }


    //호스트상태정보 수정
    function modify(memId) {
        var memId=memId;
        var memstatus=$("#memStatus_"+memId).val();

        $.ajax({
            type: "put",
            url: "/admin_statusModify"+memId,
            contentType: "application/json",
            data : JSON.stringify({"memStatus":memStatus}),
            dataType: "text",
            success: function (result) {
                if(result=="success"){
                    memberTableBody(page);
                }
            },
            error: function(xhr) {
                alert("에러코드(호스트 상태 변경) = "+xhr.status)
            }
        });
    }


</script>

</body>
</html>
